---
title: "Linear Regression"
---

This is where the linear regression goes

@tbl-projectsoverview shows an overview of all projects

```{r}
#| label: tbl-projectsoverview
#| tbl-cap: Project count and budget per country
#| echo: false
#| warning: false
#| cache: true
library("RSQLite")
library("dplyr")

## connect to db
con <- dbConnect(drv=RSQLite::SQLite(), dbname="ICA_2023.sqlite")

projectsOverview <- dbGetQuery(
  con,
  'SELECT
      ProjectName,
      Name AS ProjectLead,
      Budget,
      JULIANDAY(StartDate) < JULIANDAY(DATE(\'now\')) AS Started,
      JULIANDAY(EndDate) < JULIANDAY(DATE(\'now\')) AS Completed,
      Count(DISTINCT A.AssetID) AS AssetCount,
      Count(DISTINCT AD.DeveloperID) AS AssetDevCount,
      CASE
          WHEN
              JULIANDAY(ExpectedCompletionDate) < JULIANDAY(DATE(ActualCompletionDate))
              OR
              JULIANDAY(ExpectedCompletionDate) < JULIANDAY(DATE(\'now\')) AND ActualCompletionDate IS NULL
          THEN
              TRUE
          ELSE
              FALSE
          END AS MissedMilestone
  FROM Projects
      LEFT JOIN Assets A on Projects.ProjectID = A.ProjectID
      LEFT JOIN AssetsDevelopers AD on A.AssetID = AD.AssetID
      JOIN ProjectDevelopers PD on Projects.ProjectID = PD.ProjectID
      JOIN Developers D on D.DeveloperID = PD.DeveloperID
      LEFT JOIN Timelines T on Projects.ProjectID = T.ProjectID
  GROUP BY Projects.ProjectID;'
)

dbDisconnect(con)

# Converting integer columns to bools
projectsOverview <- projectsOverview %>%
  mutate(Started = ifelse(Started == 1, TRUE, FALSE)) %>%
  mutate(Completed = ifelse(Completed == 1, TRUE, FALSE)) %>%
  mutate(MissedMilestone = ifelse(MissedMilestone == 1, TRUE, FALSE))

# Show up to 7 rows. If data has more than 7 entries, show the first 8 with pagination
if(nrow(projectsOverview) <= 7) {
  knitr::kable(head(projectsOverview, 7), align='lcc')
} else {
  DT::datatable(projectsOverview, options = list(pageLength = 8, columnDefs = list(list( className = 'dt-center', targets = 2:3))))
}
```